import sys
sys.path.append("/media/Paulo/Workspace/spotify/fusetree")


import fusetree
import logging
from stat import S_IFDIR, S_IFLNK, S_IFREG
import time
import fuse


#def IterableGenerator(func: callable) -> callable:
    #def tmp(*args, **kwargs):
        #class Iterable:
            #def __init__(self, func, *args, **kwargs):
                #self.func = func
                #self.args = args
                #self.kwargs = kwargs

            #def __iter__(self):
                #return self.func(*self.args, **self.kwargs)

        #return Iterable(func, *args, **kwargs)
    #return tmp



@fusetree.generatorfile
def count(n=None):
    i = 1
    while n is None or i <= n:
        yield str(i) + '\n'
        i += 1

@fusetree.generatorfile
def bottles(n):
   for i in range(n, 0, -1):
      yield \
f"""\
{i} {"bottle" if i == 1 else "bottles"} of beer on the wall
{i} {"bottle" if i == 1 else "bottles"} of beer
Take one down, pass it around
{i-1} {"bottle" if i - 1== 1 else "bottles"} of beer on the wall

"""

rootNode = {
    'file': 'The content of this file is hardcoded and cannot be edited Â¯\_(ãƒ„)_/Â¯\n',
    'dir':{'README': 'The content of this directory is hardcoded and cannot be modified'},
    'editable_file': fusetree.BlobFile(b'You can edit this file!\n', rw=True),
    'editable_dir': fusetree.DictDir({'README': fusetree.BlobFile(b'You can edit the contents of this directory.\n\nTry to create files, folders, symlinks, hardlinks, rename and delete them.\n', rw=True)}, rw=True),

    # https://commons.wikimedia.org/wiki/File:JPEG_example_JPG_RIP_001.jpg
    'binary.jpg': b'\xff\xd8\xff\xe0\x00\x10JFIF\x00\x01\x01\x01\x00H\x00H\x00\x00\xff\xdb\x00C'
                + b'\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff'
                + b'\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff'
                + b'\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff'
                + b'\xff\xff\xff\xff\xff\xff\xff\xff\xff\xdb\x00C\x01\xff\xff\xff\xff\xff\xff\xff'
                + b'\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff'
                + b'\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff'
                + b'\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff'
                + b'\xff\xc0\x00\x11\x08\x00\xea\x019\x03\x01"\x00\x02\x11\x01\x03\x11\x01\xff'
                + b'\xc4\x00\x17\x00\x01\x01\x01\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'
                + b'\x00\x00\x01\x02\x03\xff\xc4\x00$\x10\x01\x01\x01\x00\x02\x01\x04\x03\x01\x01'
                + b'\x01\x01\x00\x00\x00\x00\x00\x01\x11!1A\x02\x12Qqa\x81\x91\xb1\xa1\xc1\xf0'
                + b'\xff\xc4\x00\x15\x01\x01\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'
                + b'\x00\x00\x00\x01\xff\xc4\x00\x16\x11\x01\x01\x01\x00\x00\x00\x00\x00\x00\x00'
                + b'\x00\x00\x00\x00\x00\x00\x00\x11\x01\xff\xda\x00\x0c\x03\x01\x00\x02\x11\x03'
                + b'\x11\x00?\x00\xca\xe2/ \x8a\x82\r`C\x00\xa0\xb3\x81S0\xe7n\xb5\xeacA\xa9>\x173'
                + b'\x12V\xa81e\xd4]<\xf2\x08\xbc~V\xcf1\x9d\x06\xb8\xa9\x86\xd4\xde\x01x6f2\x80'
                + b'\xd6\x9a\x8a\rA\x99q\xad\xdf\xa0\x17\xa4\xf2\x01o\xf0\x87\xb7|\xa7@\xd6\xa6'
                + b'\xfc\xb3\xb8h/\xa7\x8bV\xdeu\x16\xc0\'\xaa]\xd4\xb7S;\x01f\xdf\x94\xb3\x03'
                + b'\x90C\x17\xfc^\xbfb2\xbf\xa4\x00\xc5@\x05\r\x03\xa6\xa5a\xa8\n\x93\xbd\xa6\xfe'
                + b'?i\xe0\x1a\xb6|0\xd2`\xa2\xcd\\\xf3K\xa0q?5>\x91`-\xf5p\x9cY\xdf%\x953\xe6\x81'
                + b'b/\xd2\xd9\x98"\x02\xc9\xd8\'\x1eC\xdb[\xcf\x9a\xaa\xe6\xdc\xf4\xdf\xa5\x040'
                + b'\xc8\x00\xbc%\x9b\xd2(9\xe2\xe3Vk2\xe5\x15V_\x94\xcf\xdc=\xbf\xfdPZ\xb6lg\x99'
                + b'\xc5<v\x07\xf8\x96r\xba\xb7\x90H^L\xf9\xf2t\x08\x07\xf0D\x05Q\x05\x005\x0c\x05'
                + b'\x95Q\xac\xa8%E\xa8\x0e\x9b1\x9e\xd3\xec\xb9\xe0U\xe3\xe5q\x85\xdc\x80\xb6\xff'
                + b'\x00\x8c\xe2\xc6\xa4\x80\xcc-\xb7\x86\xbd\xb1x\x8a\x8c\xc9~\xbf\xd6\xba@\x15'
                + b'\x00\x10\x17\x01\x05\xc4\x00\x00\x12\xcdP\x19t\xed\x966\x8a\xdd\x9b\xe7\xa6'
                + b'\x16^\xd7q\x04\x8df!m\xbf@\xbd\xc3\xdd\'\x84\x97\xf8\x98\rn\xf8g\t\x17\x022'
                + b'\x02\xa2\xff\x00\xea/\xc2\x01\x8d}$jt\x8a\xcdkoL\xd2\x02\x82\x02\x88\xd4\xf4'
                + b'\xf0\x0c\x8de\xe9rA\t\x14\xd1D\x00\x05\xc4P\x10\x01c>\xabgK\xaby\x07=\xbf+}_'
                + b'\x10\xc5\xd9\x00\x17\xb4\x00\\@\x0b4\x01\x9c\xb0\x92\xf9n%\xbc\xa2\xa6\'\xda'
                + b'\xb3\x9d\x83s,c\x95\x9c\x1e\x00\xed1\xae/\xe1s\xec\x198B\x88\xbb\xa9\xd2\xc9'
                + b'\xe4\xe8U\x9c\x96_\x0b\xc2\x83\x9d\xe0[\xcdPC\xb6\x934\t\xf9tfI>\xcdT]DP\x01A'
                + b'\x0c\tt\x0bdOw=\x16y\x84\xf4\xe04\xca\xdb#2\x82\x9b\x9d\x8bg\x00\xac\xfbc<'
                + b'\xc3h7\xb23\xeed\x05\xdb\xe0\x8b\x0c\x01@\x02\xcdU\x063\x8f\xca\xfagz\xbcE'
                + b'\xd4S#9<4t#\x16\x1e\xea\xb6\xa6\x8a\x1d\x154\x1a\xd2\xe3\x1a*7\xc45\x04T$\xdf*'
                + b'\xb2\x02\xc8\xa8\x8a\x80\x00*\x00\xd2$\xbe?\x8d\x02\'\xe6(\x0b\xac\xfa\xad:'
                + b'\xe7\xfa\xa0\xe6\xb1l\xca\x00\x96\xd5\x00\x86\x12(&(\xa0\x82\xb3\xee\xf8\x06'
                + b'\x8e#\x1b@_r[h\x02\x1a/\x08\xb8\xb7\xd5\xf8Ow\xe0\xd8\x01m\xa9\xca\xd4Q\xaa'
                + b'\xcf\xdbL\xd4\x0c\t\xaa\xa0M\x16D\x16O5U\x15\x10\x00\x00\x01P\x02\xf2K\xe2'
                + b'\x87`\xd2+\x13\x9d\x06\xab;gIt\x80\x8d&(\x00\xb8\x02\xe1\xc4\xed\x9bA\xae#>\xef'
                + b'\x8e\x10\x00\x00\x00\x00\x10\x05\xb2\xf7\x88\xb6\xd0H\x0b&\xa2\x92\xfc\xb5\xfa'
                + b'\xbf\xc2z~kY\x01\xc8\x05\x06\xb8\xac\x80\xd1\xa9)y\xa85\xaa\xce*\xa0\x00\x00'
                + b'\x00L\x0e\xc1\xa4gj]\xbd\x82\xdb\xe2\x7fR\x00-E\x00RB\xd9\x01Y\xbe\xaf\x84\xb6'
                + b'\xd0\x00\x00\x00\x00@Q\x00\x00\x00\x01F\xe6\xf8fMt\xfc@?\xea\xa5\xd98\xf0\xc7'
                + b'\xbf\xf0"\x06|\x88\xab\xc1\x93\xe0\x89\xa0%\xe2\x8b\xd8\x1a\xa9\x9f\xea\xaa(@'
                + b'\x00\x01\x15\x00\x11\xa4\x04U0\x05\xfbM\x91\x9d\xd0[~\x10\x00\x00\x01\x14\x04'
                + b'\x00T\x00\x00\x00\x00\x11VI|\x82\xcf\xf8\xde\xc95\x8c\xbe9.\xf1\xc0\xad\xead'
                + b'\xf8OWLm\xf9\xa0\xba\xac\x98\x82\xa6,\x012\x80\xa84\xcbP\x05@\x15\x17\xc2\x00'
                + b'\x00\x02\x80B\xdf\x84\xb7P\x00\x00\x04\x05@\x00\x00\x00\x00\x10\x14@\x05@\x05'
                + b'\xd4PkS\xdcc(\xad\xdb>|3\xc0\xb8\xa2\xe365zN\x10g\x96\xb4\xd6Tj\xd8\x80"\x80'
                + b'\n"\x80\xa8\x02\x81\xb8\x0b\xd3\x16\xe9\xd8\x08\xa0\x02\x00\x00\x00\x00\x00'
                + b'\x00\x8aX\x08\x0b\xd0 \x00\x00\x02\xe2\x00\xd0\x8a\x8a\x83K\x80\xcdB\xac\xb8'
                + b'\xa1\x996\x9f\x92\xddD\x17t\x99\xe5\x95T[\x89\xa7 \xab\xc0\x8b\x97\xe1\x11DU'
                + b'\reP\x05\x10\x00\x00\x00\x00\x00\x04\x05E\\\x80\xca\xe9`\x02\xa0\x8a\x94_\x08'
                + b'\xa8\xbb\x04\x80/f\x1a\x80\xbe"\xeb*\n\xbb\xf9dE\x15:MQ\xb8\x97\xf0H\xb3\x8e'
                + b'\x90ab\xe1s\xc2\xa1\x86+6"\x9a\xba\x8b\x01\x1a/H\n\xcbL\xd5@\x00\x00\x00\x00'
                + b'\x15\r\x15q0@]A\xa0"\xa1\xa8*\x12\x80\xcd\x14TA@0\xc6\x84\xab\x19\x1ad@\x0f'
                + b'\xea\x8a\x8b\x0e/\xda\t\xa6\xd3\x11EVZ\xd1U*J \xa1\x13\xa0j2\x00\xb0\xa8\xaa'
                + b'\x88\xa2\x00\x08\x02\xa2\x82*\x02\xa8\xa2\x084\x94\x11n \xa8\x00\x00\x02\x8dFW'
                + b'\xf6\x82\xab\x1f\xb6\xc1-ej\x00\x02\xa0\x00\x08\xaa\x0c\xa8\x00\x1eJ\x8a\xa9'
                + b'\xdf\xd9\x0b\xd8\n\x8b:Q<\xac@E@\x04X\x00\xb8b\x82\xb3B\xf6\x01\xa6\xa2\x82'
                + b'\xe9\xe1<\x1e\x11\x01E\x04P\x04\n\x02(\x02\xed"|\x80*\x00\x00?\xff\xd9',
    'emoji': 'ðŸ˜˜â˜ºðŸ˜—ðŸ˜„ðŸ˜ðŸ‘»ðŸ™ˆðŸ™‰ðŸ™ŠðŸ‘¶ðŸ‘¦ðŸ‘§ðŸ™†ðŸ’ðŸ‘°ðŸ‘¼ðŸ‘¯ðŸ›€ðŸ„ðŸš´ðŸ’ªðŸ’ðŸ‘­âœŒðŸ‘ðŸ‘ŠðŸ™ðŸ‘…ðŸ‘„ðŸ’‹ðŸ’žðŸ’¥ðŸ’¦ðŸ’¨ðŸ‘™ðŸ‘‘ðŸ’ðŸ’ŽðŸ¼ðŸ°ðŸ˜ðŸ¬ðŸŸðŸŒ»ðŸŸðŸ•ðŸŽ‚ðŸ°ðŸ«ðŸ¬ðŸ­\n',
    'â˜º': fusetree.Symlink('emoji'),
    'array': [
        'Mary had a little lamb,\n',
        'Its fleece was white as snow;\n',
        'And everywhere that Mary went,\n',
        'The lamb was sure to go.\n'],
    'count-100': count(100),
    'count-forever': count(),
    '99-bottles': bottles(99),
    'xkcd': fusetree.HttpFile('https://xkcd.com'),
    'linux.tar.xz': fusetree.HttpFile('https://cdn.kernel.org/pub/linux/kernel/v4.x/linux-4.15.4.tar.xz'),
    'link-to-99-bottles': fusetree.Symlink('99-bottles'),
}

if __name__ == '__main__':
    logging.basicConfig(level=logging.DEBUG)
    fusetree.FuseTree(rootNode, '/tmp/fusetree', foreground=True)
